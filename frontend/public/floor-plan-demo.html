<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floor Plan Demo - Atlas CMMS</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        #map {
            height: 600px;
            width: 100%;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12);
        }
        .legend {
            background: white;
            padding: 15px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12);
            margin-top: 20px;
        }
        .legend h3 {
            margin-top: 0;
            color: #333;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        .legend-icon {
            width: 32px;
            height: 32px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .drawer {
            position: fixed;
            right: -450px;
            top: 0;
            width: 400px;
            height: 100%;
            background: white;
            box-shadow: -2px 0 8px rgba(0,0,0,0.2);
            transition: right 0.3s ease;
            z-index: 10000;
            overflow-y: auto;
            padding: 30px;
        }
        .drawer.open {
            right: 0;
        }
        .drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .drawer h2 {
            margin: 0;
            color: #1976d2;
        }
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 5px;
        }
        .drawer-content {
            margin-top: 20px;
        }
        .info-item {
            margin-bottom: 20px;
        }
        .info-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .info-value {
            font-size: 16px;
            color: #333;
            font-weight: 500;
        }
        .chip {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 500;
        }
        .chip-success {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        .chip-error {
            background-color: #ffebee;
            color: #c62828;
        }
        .chip-warning {
            background-color: #fff3e0;
            color: #e65100;
        }
        .chip-info {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        .features {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 4px;
            margin-top: 20px;
        }
        .features h3 {
            margin-top: 0;
            color: #1976d2;
        }
        .features ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .features li {
            margin: 8px 0;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üó∫Ô∏è Digital Twin Floor Plan - Demo</h1>
        <p class="subtitle">Interactive floor plan visualization for Atlas CMMS Location View</p>
        
        <div id="map"></div>
        
        <div class="legend">
            <h3>Legend</h3>
            <div class="legend-item">
                <div class="legend-icon">‚úÖ</div>
                <div>
                    <strong>Green:</strong> Operational Asset
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">‚ùå</div>
                <div>
                    <strong>Red:</strong> Down / Emergency Shutdown
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">‚ö†Ô∏è</div>
                <div>
                    <strong>Yellow:</strong> Inspection Scheduled
                </div>
            </div>
            <div class="legend-item">
                <div class="legend-icon">üîß</div>
                <div>
                    <strong>Blue:</strong> Work Order / Maintenance
                </div>
            </div>
        </div>

        <div class="features">
            <h3>‚ú® Implemented Features</h3>
            <ul>
                <li>‚úÖ <strong>React Leaflet with CRS.Simple</strong> - Non-geographic coordinate system for building plans</li>
                <li>‚úÖ <strong>ImageOverlay</strong> - Displays floor plan image as map background</li>
                <li>‚úÖ <strong>Custom MUI Icons</strong> - Status-based markers using Material-UI components</li>
                <li>‚úÖ <strong>Interactive Markers</strong> - Click markers to view details</li>
                <li>‚úÖ <strong>MUI Drawer</strong> - Side panel for asset and work order details (click a marker!)</li>
                <li>‚úÖ <strong>Asset Visualization</strong> - Real-time asset status display</li>
                <li>‚úÖ <strong>Work Order Tracking</strong> - Visualize work orders on floor plan</li>
                <li>‚úÖ <strong>Responsive Design</strong> - Works on desktop and mobile</li>
                <li>‚úÖ <strong>Integrated into Location View</strong> - Floor Plans tab in location details</li>
            </ul>
        </div>
    </div>

    <div id="drawer" class="drawer">
        <div class="drawer-header">
            <h2 id="drawer-title">Asset Details</h2>
            <button class="close-btn" onclick="closeDrawer()">‚úï</button>
        </div>
        <hr>
        <div id="drawer-content" class="drawer-content"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize the map with CRS.Simple (pixel-based coordinates)
        var map = L.map('map', {
            crs: L.CRS.Simple,
            minZoom: -2,
            maxZoom: 2,
            zoomControl: true
        });

        // Create a placeholder floor plan image (SVG)
        var floorPlanSvg = 'data:image/svg+xml;base64,' + btoa(`
            <svg width="1000" height="800" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <pattern id="grid" width="50" height="50" patternUnits="userSpaceOnUse">
                        <path d="M 50 0 L 0 0 0 50" fill="none" stroke="#ddd" stroke-width="1"/>
                    </pattern>
                </defs>
                <rect width="1000" height="800" fill="#f9f9f9"/>
                <rect width="1000" height="800" fill="url(#grid)" />
                
                <!-- Building outline -->
                <rect x="50" y="50" width="900" height="700" fill="white" stroke="#333" stroke-width="3"/>
                
                <!-- Rooms -->
                <rect x="50" y="50" width="300" height="350" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
                <text x="200" y="230" font-family="Arial" font-size="18" fill="#1976d2" text-anchor="middle">Production Area</text>
                
                <rect x="50" y="400" width="300" height="350" fill="#fff3e0" stroke="#f57c00" stroke-width="2"/>
                <text x="200" y="580" font-family="Arial" font-size="18" fill="#f57c00" text-anchor="middle">Storage Room</text>
                
                <rect x="350" y="50" width="300" height="350" fill="#e8f5e9" stroke="#388e3c" stroke-width="2"/>
                <text x="500" y="230" font-family="Arial" font-size="18" fill="#388e3c" text-anchor="middle">Assembly Line</text>
                
                <rect x="350" y="400" width="300" height="350" fill="#fce4ec" stroke="#c2185b" stroke-width="2"/>
                <text x="500" y="580" font-family="Arial" font-size="18" fill="#c2185b" text-anchor="middle">Quality Control</text>
                
                <rect x="650" y="50" width="300" height="700" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
                <text x="800" y="400" font-family="Arial" font-size="18" fill="#7b1fa2" text-anchor="middle">Warehouse</text>
                
                <text x="500" y="30" font-family="Arial" font-size="24" fill="#333" text-anchor="middle" font-weight="bold">Factory Floor Plan - Demo</text>
            </svg>
        `);

        // Image bounds
        var imageBounds = [[0, 0], [800, 1000]];
        
        // Add the floor plan image
        L.imageOverlay(floorPlanSvg, imageBounds).addTo(map);
        
        // Fit map to image bounds
        map.fitBounds(imageBounds);

        // Mock assets data
        var assets = [
            { id: 1, name: 'CNC Machine A', status: 'OPERATIONAL', position: [200, 150], description: 'High-precision CNC milling machine', model: 'Haas VF-2', serialNumber: 'HAS-001-2023' },
            { id: 2, name: 'Assembly Robot', status: 'OPERATIONAL', position: [200, 500], description: '6-axis industrial robot', model: 'KUKA KR 10', serialNumber: 'KUK-042-2022' },
            { id: 3, name: 'Conveyor Belt 1', status: 'DOWN', position: [550, 200], description: 'Main production conveyor', model: 'ConveyPro 3000', serialNumber: 'CVY-123-2021' },
            { id: 4, name: 'Quality Scanner', status: 'INSPECTION_SCHEDULED', position: [500, 600], description: 'Automated quality inspection system', model: 'QualityScan Pro', serialNumber: 'QSP-789-2023' },
            { id: 5, name: 'Packaging Unit', status: 'OPERATIONAL', position: [800, 400], description: 'Automated packaging station', model: 'PackMaster 2000', serialNumber: 'PKM-456-2022' }
        ];

        // Mock work orders
        var workOrders = [
            { id: 1, title: 'Conveyor Belt Repair', priority: 'HIGH', position: [550, 250], description: 'Belt motor needs replacement', status: 'IN_PROGRESS' },
            { id: 2, title: 'Scheduled Inspection', priority: 'MEDIUM', position: [500, 650], description: 'Quarterly inspection due', status: 'OPEN' },
            { id: 3, title: 'Routine Maintenance', priority: 'LOW', position: [200, 200], description: 'Regular lubrication and cleaning', status: 'OPEN' }
        ];

        // Create custom icon HTML
        function createMarkerIcon(type, status) {
            var color, icon;
            if (type === 'asset') {
                switch(status) {
                    case 'OPERATIONAL':
                        color = '#2e7d32';
                        icon = '‚úì';
                        break;
                    case 'DOWN':
                    case 'EMERGENCY_SHUTDOWN':
                        color = '#c62828';
                        icon = '‚úï';
                        break;
                    case 'INSPECTION_SCHEDULED':
                        color = '#e65100';
                        icon = '‚ö†';
                        break;
                    default:
                        color = '#1976d2';
                        icon = '?';
                }
            } else { // work order
                switch(status) {
                    case 'HIGH':
                    case 'CRITICAL':
                        color = '#c62828';
                        break;
                    case 'MEDIUM':
                        color = '#e65100';
                        break;
                    default:
                        color = '#1976d2';
                }
                icon = 'üîß';
            }
            
            return L.divIcon({
                html: `<div style="background: ${color}; border: 3px solid white; border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); color: white; font-weight: bold;">${icon}</div>`,
                className: 'custom-marker',
                iconSize: [36, 36],
                iconAnchor: [18, 18]
            });
        }

        // Add asset markers
        assets.forEach(function(asset) {
            var marker = L.marker(asset.position, {
                icon: createMarkerIcon('asset', asset.status)
            }).addTo(map);
            
            marker.bindPopup(`<strong>${asset.name}</strong><br>Status: ${asset.status}`);
            
            marker.on('click', function() {
                showAssetDetails(asset);
            });
        });

        // Add work order markers
        workOrders.forEach(function(wo) {
            var marker = L.marker(wo.position, {
                icon: createMarkerIcon('workOrder', wo.priority)
            }).addTo(map);
            
            marker.bindPopup(`<strong>${wo.title}</strong><br>Priority: ${wo.priority}`);
            
            marker.on('click', function() {
                showWorkOrderDetails(wo);
            });
        });

        // Show asset details in drawer
        function showAssetDetails(asset) {
            document.getElementById('drawer-title').textContent = 'Asset Details';
            
            var statusClass = 'chip-info';
            if (asset.status === 'OPERATIONAL') statusClass = 'chip-success';
            else if (asset.status === 'DOWN') statusClass = 'chip-error';
            else if (asset.status === 'INSPECTION_SCHEDULED') statusClass = 'chip-warning';
            
            document.getElementById('drawer-content').innerHTML = `
                <div class="info-item">
                    <div class="info-label">Name</div>
                    <div class="info-value">${asset.name}</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">Description</div>
                    <div class="info-value">${asset.description}</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">Status</div>
                    <div><span class="chip ${statusClass}">${asset.status}</span></div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">Model</div>
                    <div class="info-value">${asset.model}</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">Serial Number</div>
                    <div class="info-value">${asset.serialNumber}</div>
                </div>
            `;
            
            document.getElementById('drawer').classList.add('open');
        }

        // Show work order details in drawer
        function showWorkOrderDetails(wo) {
            document.getElementById('drawer-title').textContent = 'Work Order Details';
            
            var priorityClass = 'chip-info';
            if (wo.priority === 'HIGH' || wo.priority === 'CRITICAL') priorityClass = 'chip-error';
            else if (wo.priority === 'MEDIUM') priorityClass = 'chip-warning';
            
            var statusClass = 'chip-info';
            if (wo.status === 'COMPLETED') statusClass = 'chip-success';
            else if (wo.status === 'IN_PROGRESS') statusClass = 'chip-warning';
            
            document.getElementById('drawer-content').innerHTML = `
                <div class="info-item">
                    <div class="info-label">Title</div>
                    <div class="info-value">${wo.title}</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">Description</div>
                    <div class="info-value">${wo.description}</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">Priority</div>
                    <div><span class="chip ${priorityClass}">${wo.priority}</span></div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">Status</div>
                    <div><span class="chip ${statusClass}">${wo.status}</span></div>
                </div>
            `;
            
            document.getElementById('drawer').classList.add('open');
        }

        // Close drawer
        function closeDrawer() {
            document.getElementById('drawer').classList.remove('open');
        }
    </script>
</body>
</html>
